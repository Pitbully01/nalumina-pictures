# Nalumina Pictures

Eine moderne Web-Anwendung f√ºr die Verwaltung und Freigabe von Fotogalerien mit professionellem Workflow f√ºr Fotografen und Kunden.

## Features

- üì∏ **Galerie-Management**: Erstellen und verwalten von Fotogalerien mit SEO-freundlichen Slugs
- üåê **√ñffentliche Galerien**: Automatische Cover-Generierung mit Mosaik oder manuellen Covers
- üîí **Flexible Sichtbarkeit**: Private und √∂ffentliche Galerien mit isPublic-Flag
- üîó **Intelligente URL-Struktur**: Slug-basierte URLs mit automatischen Weiterleitungen
- ‚òÅÔ∏è **Cloud Storage**: AWS S3/MinIO Integration f√ºr sichere Bildspeicherung
- üñºÔ∏è **Automatische Bildverarbeitung**: Sharp-basierte Bildoptimierung mit WebP-Konvertierung
- üë• **Benutzerrollen**: Admin, Photographer und Client Rollen mit NextAuth.js
- üîß **Administrator-Setup**: Automatische Administrator-Erstellung √ºber Umgebungsvariablen
- üí¨ **Interaktion**: Kommentare und Reaktionen (Like, Dislike)
- üîê **Sichere Authentifizierung**: Bcrypt-basierte Passwort-Hashes
- üì± **Responsive Design**: Optimiert f√ºr alle Ger√§te mit professionellem Image Viewer
- ‚ö° **Performance**: Turbopack f√ºr schnelle Entwicklung und Builds
- üê≥ **Container-Ready**: Docker Compose f√ºr einfache Entwicklung
- üéØ **Erweiterte Navigation**: Hierarchische Galerien mit Parent-Child-Beziehungen
- üîÑ **Automatische Weiterleitungen**: SEO-optimiert bei Slug-√Ñnderungen

## Tech Stack

- **Frontend**: Next.js 15.5.4, React 19.1.0, TypeScript 5, Tailwind CSS 4
- **Backend**: Next.js API Routes, NextAuth.js 4.24.11
- **Database**: PostgreSQL 16 mit Prisma ORM 6.16.3
- **Storage**: AWS S3 SDK v3.899.0 oder MinIO (lokal)
- **Bildverarbeitung**: Sharp 0.34.4
- **Authentifizierung**: NextAuth.js mit bcryptjs
- **Development**: Turbopack, ESLint 9
- **Deployment**: Docker Compose

## Installation

1. Repository klonen:
```bash
git clone <repository-url>
cd nalumina-pictures
```

2. Dependencies installieren:
```bash
npm install
```

3. Entwicklungsumgebung mit Docker starten:
```bash
docker-compose up -d
```
Dies startet:
- PostgreSQL 16 Datenbank (Port 5432)
- MinIO S3-kompatible Storage (Port 9000, Console: 9001)

4. Environment variables einrichten:
```env
# .env.local erstellen mit folgenden Variablen:
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/picdrop"
AWS_REGION="us-east-1"
AWS_ACCESS_KEY_ID="minio"
AWS_SECRET_ACCESS_KEY="minio12345"
S3_BUCKET_NAME="nalumina-pictures"
S3_ENDPOINT="http://localhost:9000"
NEXTAUTH_SECRET="your-secret-key"
NEXTAUTH_URL="http://localhost:3000"

# Administrator-Setup (optional)
ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="admin123"
ADMIN_NAME="Administrator"
```

5. Database setup:
```bash
npx prisma migrate dev
npx prisma generate

# Administrator erstellen (falls ADMIN_* Variablen gesetzt sind)
npm run db:seed
```

6. MinIO Bucket erstellen:
   - √ñffne http://localhost:9001
   - Login: minio / minio12345
   - Erstelle Bucket "nalumina-pictures"

7. Development server starten:
```bash
npm run dev
```

Die Anwendung ist dann unter `http://localhost:3000` verf√ºgbar.

## Administrator Setup

Das System unterst√ºtzt die automatische Erstellung eines Standard-Administrators √ºber Umgebungsvariablen.

### Konfiguration
F√ºgen Sie folgende Variablen in Ihre `.env` Datei hinzu:

```env
# Administrator-Setup
ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="sicheres-passwort"
ADMIN_NAME="Administrator"
```

### Administrator erstellen
```bash
# Einmalig oder bei √Ñnderungen ausf√ºhren
npm run db:seed
```

Das Script:
- ‚úÖ Erstellt automatisch einen Administrator mit den angegebenen Daten
- ‚úÖ Pr√ºft, ob bereits ein User mit der Email existiert (keine Duplikate)
- ‚úÖ Hasht das Passwort sicher mit bcryptjs
- ‚úÖ Weist die `ADMIN` Rolle zu

### Verwendung
- **Erste Installation**: Administrator wird automatisch bei `npm run db:seed` erstellt
- **Passwort √§ndern**: Neue Werte in `.env` setzen und `npm run db:seed` erneut ausf√ºhren
- **Produktionsumgebung**: Starke Passw√∂rter verwenden und `.env` nie in Git einchecken

## Roadmap

### M1 ‚Äì Untergalerien & Slugs ‚úÖ
- [x] Hierarchische Galerien mit Parent-Child-Beziehungen
- [x] SEO-freundliche Slug-basierte URLs
- [x] Automatische Slug-Weiterleitungen
- [ ] Catch-all Routing f√ºr verschachtelte Pfade
- [ ] Breadcrumb-Navigation
- [ ] Parent-Galerie Auswahl/√Ñnderung im Admin
- [ ] Grid-Ansicht zeigt Untergalerien + Bilder kombiniert

### M2 ‚Äì Feedback ‚ö†Ô∏è
- [x] Grundlegende Like/Dislike Funktionalit√§t
- [x] Kommentar-System (Basic CRUD)
- [x] Farb-Labels f√ºr Bilder (RED, YELLOW, GREEN, BLUE, PURPLE)
- [ ] Aggregierte Like/Dislike Anzeige
- [ ] Kommentar-Moderation f√ºr Admins
- [ ] Filter nach Farb-Labels
- [ ] Erweiterte Reaktions-Statistiken

### M3 ‚Äì Sharing üîÑ
- [x] Basis √∂ffentliche Galerien (`isPublic` Flag)
- [ ] Share-Links mit verschiedenen Modi (LINK/PIN/Expiry)
- [ ] PIN-gesch√ºtzte Galerien
- [ ] Ablaufende Share-Links
- [ ] Public-Ansicht Sicherheitsh√§rtung
- [ ] Settings UI f√ºr Share-Konfiguration
- [ ] Eingeladene Benutzer per Email

### M4 ‚Äì Pipeline üìã
- [x] Sharp-basierte Bildverarbeitung
- [x] WebP-Konvertierung
- [x] Drei Bildgr√∂√üen (Original, Large, Thumbnail)
- [ ] EXIF-Daten Extraktion und Anzeige
- [ ] Automatische Bildrotation basierend auf EXIF
- [ ] Asynchrone Thumbnail-Generierung mit Queue
- [ ] Retry-Mechanismus f√ºr fehlgeschlagene Verarbeitung
- [ ] Fehler-UI f√ºr Upload/Verarbeitung

### M5 ‚Äì Robustheit & Performance üîß
- [ ] Input-Validation f√ºr alle API-Endpoints
- [ ] Rate-Limiting f√ºr Uploads und API-Calls
- [ ] Application-Monitoring und Logging
- [ ] Client-side Caching mit SWR/React Query
- [ ] Server-side Caching f√ºr h√§ufige Abfragen
- [ ] Custom `next/image` Loader f√ºr S3/MinIO
- [ ] Optimistische Updates f√ºr bessere UX

### M6 ‚Äì Operations & Deployment üöÄ
- [ ] Automatische Datenbank-Backups
- [ ] Backup/Restore-Mechanismus f√ºr S3-Daten
- [ ] CI/CD Pipeline mit automatisierten Tests
- [ ] Unit & Integration Tests
- [ ] CDN-Integration f√ºr Bild-Delivery
- [ ] HTTPS Deployment mit SSL-Zertifikaten
- [ ] Container-Orchestrierung (Kubernetes/Docker Swarm)
- [ ] Monitoring & Alerting (Prometheus/Grafana)

### Legende
- ‚úÖ **Komplett**: Alle Features implementiert
- ‚ö†Ô∏è **Teilweise**: Grundfunktionen vorhanden, Erweiterungen geplant
- üîÑ **In Arbeit**: Aktuelle Entwicklung
- üìã **Geplant**: N√§chste Priorit√§t
- üîß **Backlog**: Zuk√ºnftige Verbesserungen
- üöÄ **Vision**: Langfristige Ziele

## Environment Variables

### Lokale Entwicklung (mit Docker Compose)
```env
# .env.local
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/picdrop"
AWS_REGION="us-east-1"
AWS_ACCESS_KEY_ID="minio"
AWS_SECRET_ACCESS_KEY="minio12345"
S3_BUCKET_NAME="nalumina-pictures"
S3_ENDPOINT="http://localhost:9000"
NEXTAUTH_SECRET="your-nextauth-secret"
NEXTAUTH_URL="http://localhost:3000"

# Administrator-Setup (optional)
ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="admin123"
ADMIN_NAME="Administrator"
```

### Produktion (AWS S3)
```env
# .env.local
DATABASE_URL="postgresql://username:password@host:5432/database"
AWS_REGION="eu-central-1"
AWS_ACCESS_KEY_ID="your-aws-access-key"
AWS_SECRET_ACCESS_KEY="your-aws-secret-key"
S3_BUCKET_NAME="your-s3-bucket"
NEXTAUTH_SECRET="your-production-secret"
NEXTAUTH_URL="https://your-domain.com"

# Administrator-Setup (optional)
ADMIN_EMAIL="admin@your-domain.com"
ADMIN_PASSWORD="secure-admin-password"
ADMIN_NAME="Administrator"
```

## API Endpoints

### Authentifizierung
- `POST /api/auth/signin` - Benutzer-Login
- `POST /api/auth/signout` - Benutzer-Logout
- `POST /api/register` - Neuen Benutzer registrieren

### Galerien
- `GET /api/galleries` - Alle Galerien abrufen (Admin-√úbersicht)
- `POST /api/galleries` - Neue Galerie erstellen mit Slug-Generierung
- `GET /api/galleries/[id]` - Einzelne Galerie per ID abrufen
- `DELETE /api/galleries/[id]` - Galerie und alle Bilder l√∂schen
- `GET /api/galleries/by-slug/[slug]` - Galerie per Slug abrufen (√∂ffentlicher Zugang)
- `PATCH /api/galleries/by-slug/[slug]` - Galerie-Einstellungen aktualisieren
- `GET /api/galleries/redirect/[oldSlug]` - Slug-Weiterleitung aufl√∂sen
- `GET /api/public-galleries` - √ñffentliche Galerien mit Cover-URLs
- `GET /api/galleries/[id]/images` - Bilder einer Galerie abrufen

### Bilder
- `GET /api/images` - Alle Bilder abrufen
- `POST /api/images` - Neuen Bilddatensatz erstellen
- `GET /api/images/[id]` - Einzelnes Bild abrufen
- `POST /api/images/[id]/process` - Bildverarbeitung (Resize, WebP-Konvertierung)

### Upload
- `POST /api/uploads/s3-url` - Presigned URL f√ºr S3/MinIO Upload generieren

## Datenmodell

### Gallery
- **URL-System**: SEO-freundliche Slugs mit automatischer Generierung aus Titeln
- **Sichtbarkeit**: `isPublic` Boolean f√ºr √∂ffentliche/private Galerien
- **Cover-System**: Automatische Mosaik-Generierung oder manuell hochgeladene Cover
- **Hierarchie**: Parent-Child-Beziehungen f√ºr verschachtelte Galerien
- **Weiterleitungen**: Automatische SlugRedirect-Erstellung bei URL-√Ñnderungen
- **Einstellungen**: `showIndexOverlay` f√ºr Lightroom-√§hnliche Bildnummerierung
- **Beziehungen**: Owner (User), Images, SlugRedirects, Children/Parent

### Image
- **Speicherung**: Original, Large (2048px), Thumbnail (400px) mit optionalen Keys
- **Format**: Automatische WebP-Konvertierung mit Sharp
- **Metadaten**: Breite, H√∂he, optionale Bildindizes und Farbmarkierungen
- **S3 Keys**: keyOriginal, keyLarge (optional), keyThumb (optional)
- **Interaktionen**: Comments, Reactions
- **Erweiterte Felder**: imageIndex, colorLabel (RED, YELLOW, GREEN, BLUE, PURPLE)

### User
- **Rolle**: `ADMIN`, `PHOTOGRAPHER` (Standard), `CLIENT`
- **Authentifizierung**: Email, Name, bcrypt-Hash f√ºr Passwort
- **Beziehungen**: Galerien (Owner), Kommentare, Reaktionen
- **Administrator**: Automatische Erstellung √ºber Umgebungsvariablen

### Comment
- **Vereinfacht**: Direkter Bezug zu User und Image
- **Inhalt**: Einfaches Text-Feld statt Body

### Reaction
- **Typen**: `LIKE`, `DISLIKE` (vereinfacht von Like/Reject/Star)
- **Eindeutigkeit**: Ein Reaction pro User und Image
- **Tracking**: Direkte User-Zuordnung

### SlugRedirect
- **SEO-Optimierung**: Automatische Weiterleitungen bei Slug-√Ñnderungen
- **Beziehungen**: Verweist auf aktuelle Galerie via galleryId

## Scripts

- `npm run dev` - Development server mit Turbopack
- `npm run build` - Production build mit Turbopack
- `npm start` - Production server starten
- `npm run lint` - Code linting mit ESLint 9
- `npm run version:patch` - Patch Version erh√∂hen
- `npm run version:minor` - Minor Version erh√∂hen
- `npm run version:major` - Major Version erh√∂hen
- `npm run db:seed` - Administrator und Seed-Daten erstellen

## Docker Deployment

### Entwicklung
```bash
# Services starten (PostgreSQL + MinIO)
docker-compose up -d

# Services stoppen
docker-compose down

# Mit Daten l√∂schen
docker-compose down -v
```

### Produktion
Das Projekt ist bereit f√ºr Container-Deployment. Erstellen Sie ein `Dockerfile` f√ºr die Next.js-Anwendung und verwenden Sie externe PostgreSQL- und S3-Services.

## Entwicklung

Das Projekt nutzt moderne Web-Technologien:

- **Turbopack** f√ºr extrem schnelle Builds und Hot Reloads
- **Sharp 0.34.4** f√ºr hochperformante Bildverarbeitung
- **Prisma 6.16.3** f√ºr type-safe Database Operations
- **AWS S3 SDK v3.899.0** f√ºr optimierte Cloud Storage
- **NextAuth.js 4.24.11** f√ºr sichere Authentifizierung
- **TypeScript 5** f√ºr bessere Developer Experience
- **React 19.1.0** mit Server Components
- **Tailwind CSS 4** f√ºr modernen, responsive Styling

### Neue Features (v0.1.2)
- **Slug-basierte URLs**: SEO-optimierte Galerie-URLs mit automatischen Weiterleitungen
- **√ñffentliche Galerien**: Homepage mit automatischen Cover-Mosaiken
- **Erweiterte Navigation**: Hierarchische Galerien und verbesserte Benutzerf√ºhrung
- **Professioneller Image Viewer**: Zoom, Pan, Keyboard-Navigation
- **Verbesserte API-Struktur**: Konsistente Endpoint-Organisation und Fehlerbehandlung
- **Error Boundaries**: Professionelle 404/403/500 Fehlerseiten
- **Middleware-basierte Authentifizierung**: Schutz sensibler Bereiche

### Bildverarbeitung
- Automatische WebP-Konvertierung f√ºr bessere Performance
- Drei Bildgr√∂√üen: Original, Large (2048px), Thumbnail (400px)
- Optionale S3-Keys f√ºr flexible Speicherstrategien
- Presigned URLs f√ºr sichere S3-Uploads

### Sicherheit
- bcryptjs f√ºr Passwort-Hashing
- NextAuth.js f√ºr Session-Management
- Middleware-basierte Route-Protection
- Flexible Galerie-Sichtbarkeit (√∂ffentlich/privat)

## Projektstruktur

```
app/
‚îú‚îÄ‚îÄ api/                           # Next.js API Routes
‚îÇ   ‚îú‚îÄ‚îÄ auth/                     # NextAuth.js Authentifizierung
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [...nextauth]/        # NextAuth.js Handler
‚îÇ   ‚îú‚îÄ‚îÄ galleries/                # Galerie-Management APIs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route.ts             # CRUD f√ºr Galerien (Admin)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [id]/                # Galerie per ID
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts         # GET/DELETE einzelne Galerie
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ by-slug/             # Slug-basierter Zugang
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [slug]/          # √ñffentlicher Galerie-Zugang
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts     # GET/PATCH Galerie per Slug
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redirect/            # URL-Weiterleitungen
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [oldSlug]/       # Alte Slug-Aufl√∂sung
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ route.ts     # Redirect-Lookup
‚îÇ   ‚îú‚îÄ‚îÄ images/                   # Bildverarbeitung APIs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route.ts             # POST neues Bild
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [id]/               # Spezifische Bild APIs
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ route.ts        # GET einzelnes Bild
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ process/        # Bildverarbeitung
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ route.ts    # POST Bildoptimierung
‚îÇ   ‚îú‚îÄ‚îÄ public-galleries/         # √ñffentliche Galerie-API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts             # GET √∂ffentliche Galerien mit Covers
‚îÇ   ‚îú‚îÄ‚îÄ register/                 # Benutzerregistrierung
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts             # POST User-Erstellung
‚îÇ   ‚îî‚îÄ‚îÄ uploads/                  # Upload-Management
‚îÇ       ‚îî‚îÄ‚îÄ s3-url/              # S3 Presigned URLs
‚îÇ           ‚îî‚îÄ‚îÄ route.ts         # POST Upload-URL-Generierung
‚îú‚îÄ‚îÄ galleries/                    # Frontend Galerie-Seiten
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # Admin: Alle Galerien
‚îÇ   ‚îî‚îÄ‚îÄ [slug]/                  # Galerie-Detail
‚îÇ       ‚îú‚îÄ‚îÄ page.tsx             # Galerie-Ansicht mit Viewer
‚îÇ       ‚îî‚îÄ‚îÄ settings/            # Galerie-Einstellungen
‚îÇ           ‚îî‚îÄ‚îÄ page.tsx         # Admin: Galerie konfigurieren
‚îú‚îÄ‚îÄ layout.tsx                   # App Root Layout mit Navigation
‚îú‚îÄ‚îÄ page.tsx                     # Homepage mit √∂ffentlichen Galerien
‚îú‚îÄ‚îÄ providers.tsx                # App Providers (Auth, etc.)
‚îú‚îÄ‚îÄ error.tsx                    # Globale Error Boundary
‚îú‚îÄ‚îÄ not-found.tsx               # 404 Fehlerseite
‚îú‚îÄ‚îÄ unauthorized.tsx            # 403 Zugriff verweigert
‚îî‚îÄ‚îÄ globals.css                 # Globale Styles

lib/
‚îú‚îÄ‚îÄ prisma.ts                   # Prisma Database Client
‚îú‚îÄ‚îÄ s3.ts                      # AWS S3/MinIO Client mit Operationen
‚îî‚îÄ‚îÄ slug.ts                    # Slug-Generierung und Eindeutigkeit

prisma/
‚îú‚îÄ‚îÄ schema.prisma              # Erweitertes Datenbank Schema
‚îî‚îÄ‚îÄ migrations/                # Datenbank Migrationen
    ‚îú‚îÄ‚îÄ 20251003235705_add_gallery_fields_and_social_v1npx/
    ‚îú‚îÄ‚îÄ 20251004143742_add_show_index_overlay/
    ‚îî‚îÄ‚îÄ 20251004154339_add_slug_redirects/

middleware.ts                  # NextAuth Route Protection
docker-compose.yml            # Entwicklungsumgebung
next.config.ts               # Next.js Konfiguration
eslint.config.mjs           # ESLint Konfiguration
```

